name: Join the Summer Club

on: [workflow_dispatch, issues, watch]

concurrency: readme_update

jobs:
  add-member-to-club:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - name: add watcher to readme
      run: |
        curl https://avatars.githubusercontent.com/${{github.actor}} > profile.jpeg
        echo -e "profile pic: https://avatars.githubusercontent.com/${{github.actor}}?s=60&v=4"
    - name: base64 image
      run: |
       if grep -q "${{github.actor}}" summer-footer.svg
       then
        grep -v "alt='${{github.actor}}'" summer-footer.svg  > summer-footer.svg.tmp && mv summer-footer.svg.tmp summer-footer.svg
       else
        echo "doesn't exist!"
       fi

       emojies="🍸🍹👙🐠🌞🏝🥂🍺🐬🥵😎🏄🏊🐚🌻🌴🍹🏝☀️🌞🕶️👕👙👡"
       EMOJI="${emojies:$(( RANDOM % ${#emojies} )):1}"

       IMAGE="$(cat profile.jpeg | base64 -w 0)" 
       IMGTAG="<td>$EMOJI<a href='https://github.com/${{ github.actor }}'><img alt='${{ github.actor }}' src='data:image/jpeg;base64,$IMAGE' width='25px' /></a></td>"
       sed -e "\|<!-- end-marker-column-row -->|i $IMGTAG" summer-footer.svg  > summer-footer.svg.tmp && mv summer-footer.svg.tmp summer-footer.svg
    - name: Commit changes
      uses: elstudio/actions-js-build/commit@v2
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        PUSH_BRANCH: 'main'
    - uses: mfinelli/setup-imagemagick@v1
    - run:  convert profile.jpeg summer.png -resize 400x400 -gravity center -composite output.png
    - run: ls
    - name: Upload a Build Artifact
      uses: actions/upload-artifact@v2.2.3
      with:
        path: output.png
     
