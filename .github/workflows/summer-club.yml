name: Join the Summer Club

on: 
  workflow_dispatch:
    inputs:
        handle:
          description: 'GitHub Handle'
          required: true

  watch:

concurrency: readme_update

env: 
  handle: ${{github.event.inputs.handle || github.actor}}
  
jobs:
  add-member-to-club:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - name: get picture
      run: |
        curl https://avatars.githubusercontent.com/${{env.handle}}?s=120&v=4 > profile.jpeg
    - name: add ${{env.handle}} to the club
      run: |
       if grep -q "${{env.handle}}" summer-footer.svg
       then
        grep -v "alt='${{env.handle}}'" summer-footer.svg  > summer-footer.svg.tmp && mv summer-footer.svg.tmp summer-footer.svg
       else
        echo "doesn't exist!"
       fi

       emojies="🍸🍹👙🐠🌞🏝🥂🍺🐬🥵😎🏄🏊🐚🌻🌴🍹🏝☀️🌞🕶️👕👙👡"
       EMOJI="${emojies:$(( RANDOM % ${#emojies} )):1}"

       IMAGE="$(cat profile.jpeg | base64 | tr -d \\n)" 
       echo $IMAGE
       
       IMGTAG="<td>$EMOJI<a href='https://github.com/${{ env.handle }}'><img alt='${{ env.handle }}' src='data:image/jpeg;base64,$IMAGE' width='25px' /></a></td>"
       sed -e "\|<!-- end-marker-column-row -->|i $IMGTAG" summer-footer.svg  > summer-footer.svg.tmp && mv summer-footer.svg.tmp summer-footer.svg
    - name: Commit changes
      uses: elstudio/actions-js-build/commit@v2
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        PUSH_BRANCH: 'main'

